# Сайт доставки еды Star Burger

Это сайт сети ресторанов Star Burger. Здесь можно заказать превосходные бургеры с доставкой на дом.

Пример работающего сайта можно найти тут: [starburger.leks.us](https://starburger.leks.us/)

Этот же сайт, работающий с использованием Docker Engine: [starburger-in-docker.leks.us](https://starburger-in-docker.leks.us/)

![скриншот сайта](https://dvmn.org/filer/canonical/1594651635/686/)


Сеть Star Burger объединяет несколько ресторанов, действующих под единой франшизой. У всех ресторанов одинаковое меню и одинаковые цены. Просто выберите блюдо из меню на сайте и укажите место доставки. Мы сами найдём ближайший к вам ресторан, всё приготовим и привезём.

На сайте есть три независимых интерфейса. Первый — это публичная часть, где можно выбрать блюда из меню, и быстро оформить заказ без регистрации и SMS.

Второй интерфейс предназначен для менеджера. Здесь происходит обработка заказов. Менеджер видит поступившие новые заказы и первым делом созванивается с клиентом, чтобы подтвердить заказ. После оператор выбирает ближайший ресторан и передаёт туда заказ на исполнение. Там всё приготовят и сами доставят еду клиенту.

Третий интерфейс — это админка. Преимущественно им пользуются программисты при разработке сайта. Также сюда заходит менеджер, чтобы обновить меню ресторанов Star Burger.


## Запуск проекта с помощью Docker Compose

Для запуска с использованием Docker вам понадобится установленный Docker Engine с клиентом. Описание его установки можно найти [на официальном сайте](https://docs.docker.com/engine/install/).

Скачайте код:
```sh
git clone https://github.com/leksuss/star_burger.git
```

Перейдите в каталог проекта:
```sh
cd star_burger
```

Далее приведены инструкции для dev и prod версий сайта. Все команды с `docker compose` требуют прав `sudo`.

### Как запустить dev-версию сайта используя контейнеризацию

Для запуска версии для разработки вам нужно создать файл `.env` в каталоге `backend/src/star_burger/` со следующими настройками:

- `DEBUG` — дебаг-режим. Поставьте `True`.
- `SECRET_KEY` — секретный ключ проекта. Он отвечает за шифрование на сайте. Например, им зашифрованы все пароли на вашем сайте.
- `ALLOWED_HOSTS` — указать `127.0.0.1,localhost`.
- `YANDEX_GEO_API_KEY` - получить API ключ у Яндекс-геокодера в [кабинете разработчика](https://developer.tech.yandex.ru/).
- `ROLLBAR_ACCESS_TOKEN` - получить TOKEN у сервиса мониторинга [rollbar.com](https://rollbar.com/)
- `ENVIRONMENT` - задать имя окружению для отслеживания ошибок с разных инсталляций.
- `POSTGRES_HOSTNAME` - указать `db`
- `POSTGRES_USER` - задайте любое имя пользователя базы данных
- `POSTGRES_PASSWORD` - задайте любой пароль базы данных
- `POSTGRES_DB` - задайте любое название базы данных

Запустите приложение используя команду Docker Compose:
```sh
docker compose -f development/docker-compose-dev.yml up -d
```
В первый запуск нужно будет немного подождать, пока будут загружаться готовые образы docker с DockerHub и собираться фронтенд.

После успешного запуска приложения вам нужно сделать миграции, используя команду `exec` докера:
```sh
docker exec -it development-app-1 python manage.py migrate
```

Затем создать суперпользователя:
```sh
docker exec -it development-app-1 python manage.py createsuperuser
```

После чего можно в режиме реального времени наблюдать за изменениями, сделанными в коде, на сайте расположенном по адресу
http://127.0.0.1:8000


### Как запустить prod-версию сайта используя контейнеризацию

Для запуска продакшн-версии сайта вам необходим работающий веб-сервер Nginx, который необходимо настроить на работу с новым сайтом. Скопирайте файл конфигурации, чтобы Nginx его увидел, а затем отредактируйте его, заменив директиву `server_name` и задав абсолютный путь к папке проекта на сервере через переменную `$root` (без слеша в начале!). Для этого понадобятся `sudo` привилегии:
```sh
sudo cp production/starburger.conf /etc/nginx/sites-enabled/

sudo vim /etc/nginx/sites-enabled/starburger.conf
```
Сделайте `reload` для Nginx, чтобы заново считать обновленную конфигурацию:
```sh
sudo service nginx reload
```

Далее, вам нужно создать файл `.env` в каталоге `backend/src/star_burger/` со следующими настройками:

- `DEBUG` — дебаг-режим. Поставьте `False`.
- `SECRET_KEY` — секретный ключ проекта. Он отвечает за шифрование на сайте. Например, им зашифрованы все пароли на вашем сайте.
- `ALLOWED_HOSTS` — [см. документацию Django](https://docs.djangoproject.com/en/3.1/ref/settings/#allowed-hosts).
- `YANDEX_GEO_API_KEY` - получить API ключ у Яндекс-геокодера в [кабинете разработчика](https://developer.tech.yandex.ru/).
- `ROLLBAR_ACCESS_TOKEN` - получить TOKEN у сервиса мониторинга [rollbar.com](https://rollbar.com/)
- `ENVIRONMENT` - задать имя окружению для отслеживания ошибок с разных инсталляций.
- `POSTGRES_HOSTNAME` - указать `db`
- `POSTGRES_USER` - задайте имя пользователя базы данных
- `POSTGRES_PASSWORD` - задайте пароль базы данных
- `POSTGRES_DB` - задайте название базы данных

Запустите приложение используя команду Docker Compose:
```sh
docker compose -f production/docker-compose-prod.yml up -d
```
В первый запуск нужно будет немного подождать, пока будут загружаться готовые образы docker с DockerHub и собираться фронтенд.

После успешного запуска приложения вам нужно сделать миграции, используя команду `exec` докера:
```sh
docker exec -it production-app-1 python manage.py migrate
```

Затем создать суперпользователя:
```sh
docker exec -it production-app-1 python manage.py createsuperuser
```
И далее можно заходить в админку и заняться наполнением сайта.


### Как обновить сайт на продакшн-сервере

Для удобства обновления в комплект поставки входит скрипт деплоя.

Первичная настройка заключается в указании абсолютного пути к рабочей директории (`work_dir=""`):
```shell
vim production/deploy_star_burger.sh
```

После чего необходимо запустить скрипт с правами `sudo`:
```shell
./production/deploy_star_burger.sh
```


## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org). За основу был взят код проекта [FoodCart](https://github.com/Saibharath79/FoodCart).

